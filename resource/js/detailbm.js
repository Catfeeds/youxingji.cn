$('#dateClose').click(function(){$('#mask_wrap').hide();$('#all-date').hide()});$('#btnBook').click(function(){var year=parseInt($('#yearDate').val());var month=parseInt($('#monthDate').val());$.get("/index.php?m=api&c=index&v=getcalendar",{'jid':$('#jid').val(),'year':year,'month':month},function(data){if(data['MonthModel']){ms(data);$('#mask_wrap').show();$('#all-date').show()}},"JSON")});$('#pop-cal .next').click(function(){var year=parseInt($('#yearDate').val());var month=parseInt($('#monthDate').val());var date=getNextMonth(year+'-'+month+'-1').split('-');$.get("/index.php?m=api&c=index&v=getcalendar",{'jid':$('#jid').val(),'year':date['0'],'month':date['1']},function(data){if(data['MonthModel']){$('#pop-cal .pre').show();if(date['0']<=data['EndYear']&&date['1']<=data['EndMonth']){ms(data)}else{$('#pop-cal .next').hide()}}},"JSON")});$('#pop-cal .pre').click(function(){var year=parseInt($('#yearDate').val());var month=parseInt($('#monthDate').val());var date=getPreMonth(year+'-'+month+'-1').split('-');$.get("/index.php?m=api&c=index&v=getcalendar",{'jid':$('#jid').val(),'year':date['0'],'month':date['1']},function(data){if(data['MonthModel']){$('#pop-cal .next').show();ms(data)}else{$('#pop-cal .pre').hide()}},"JSON")});$('.js_num_minus1').click(function(){var num=parseInt($('.js_cur_num1').html());if(num>1){$('.js_cur_num1').html(num-1);checknum()}});$('.js_num_plus1').click(function(){var num=parseInt($('.js_cur_num1').html());$('.js_cur_num1').html(num+1);checknum()});$('.js_num_minus2').click(function(){var num=parseInt($('.js_cur_num2').html());if(num>0){$('.js_cur_num2').html(num-1);checknum()}});$('.js_num_plus2').click(function(){var num=parseInt($('.js_cur_num2').html());$('.js_cur_num2').html(num+1);checknum()});$('#btnNext').click(function(){var date=$('.detailCalendarChoosenDate').attr('datestring');var x=parseInt($('.js_cur_num1').html());var m=parseInt($('.js_cur_num2').html());if(!date){layer.msg('请选择出行日期');return false}if(x<1){layer.msg('请选择出行人数');return false}$('.headline').text('请填写联系方式');$('#pop-cal').hide();$('#detailPop').hide();$('#nexts').hide();$('.service_book').show()});$('#btnSubPre').click(function(){$('.headline').text('选择出发日期与人数');$('#pop-cal').show();$('#detailPop').show();$('#nexts').show();$('.service_book').hide()});$('#btnSubBook').click(function(){var date=$('.detailCalendarChoosenDate').attr('datestring');var x=parseInt($('.js_cur_num1').html());var m=parseInt($('.js_cur_num2').html());if(!date){layer.msg('请选择出行日期');return false}if(x<1){layer.msg('请选择出行人数');return false}var realname=$('#ContactName').val();var telephone=$('#ContactPhone').val();var email=$('#ContactEmail').val();if(!realname){layer.msg('请输入您的姓名');return false}if(!telephone){layer.msg('请输入您的手机号码');return false}if(!email){layer.msg('请输入出发地点');return false}var messages='日期：'+date+'；成人：'+x+'人；儿童：'+m+'人；来自：'+$('#jtitle').val();$.post("/index.php?m=api&c=index&v=postleave",{'realname':realname,'telephone':telephone,'email':email,'messages':messages},function(data){layer.msg(data.tips);if(data.status==1){$('#ContactName').val('');$('#ContactPhone').val('');$('#ContactEmail').val('');$('.headline').text('选择出发日期与人数');$('#pop-cal').show();$('#detailPop').show();$('#nexts').show();$('.service_book').hide();$('#pop-cal .detailCalendarChoosenDate').removeClass('detailCalendarChoosenDate');$('#mask_wrap').hide();$('#all-date').hide()}},"JSON")});function checknum(){var x=parseInt($('.js_cur_num1').html());var m=parseInt($('.js_cur_num2').html());if(x*2<m){$('.detailChildNumExceedWarning').css('display','inline-block')}else{$('.detailChildNumExceedWarning').css('display','none')}}function ms(data){$('.cal-title').text(data['MonthModel']['Year']+'年'+data['MonthModel']['Month']+'月');$('#yearDate').val(data['MonthModel']['Year']);$('#monthDate').val(data['MonthModel']['Month']);$('#pop-cal').find("tbody").html('');$tbody=$('#pop-cal').find("tbody");$tr='<tr>';for(var i=1;i<data['MonthModel']['Days'].length+1;i++){if(i%7==1){$tr+='</tr>'}if(data['MonthModel']['Days'][i-1]['IsOtherMonth']){$tr+='<td></td>'}else{if(data['MonthModel']['Days'][i-1]['DateType']==0){$tr+='<td class="off"><b>'+data['MonthModel']['Days'][i-1]['Day']+'</b></td>'}else if(data['MonthModel']['Days'][i-1]['DateType']==2){$tr+='<td><a href="javascript:;" onclick="popChoosePersonDates(this)" datestring="'+data['MonthModel']['Days'][i-1]['DateString']+'"><span class="price">¥<dfn>'+data['MonthModel']['Days'][i-1]['Price']+'</dfn></span><b class="txt"><span>'+data['MonthModel']['Days'][i-1]['DateText']+'</span></b><b>'+data['MonthModel']['Days'][i-1]['Day']+'</b></a></td>'}else if(data['MonthModel']['Days'][i-1]['DateType']==6){$tr+='<td><span class="unavailable"><span class="price"> </span><b class="txt"><span>'+data['MonthModel']['Days'][i-1]['DateText']+'</span></b><b>'+data['MonthModel']['Days'][i-1]['Day']+'</b></span></td>'}else{$tr+='<td><a href="javascript:;" onclick="popChoosePersonDates(this)" datestring="'+data['MonthModel']['Days'][i-1]['DateString']+'"><span class="price">¥<dfn>'+data['MonthModel']['Days'][i-1]['Price']+'</dfn></span><span class="group">'+data['MonthModel']['Days'][i-1]['MinPerson']+'人成团</span><b>'+data['MonthModel']['Days'][i-1]['Day']+'</b></a></td>'}}}$tbody.append($tr)}function popChoosePersonDates(obj){$('#pop-cal .detailCalendarChoosenDate').removeClass('detailCalendarChoosenDate');$(obj).addClass('detailCalendarChoosenDate')}function getPreMonth(date){var arr=date.split('-');var year=arr[0];var month=arr[1];var day=arr[2];var days=new Date(year,month,0);days=days.getDate();var year2=year;var month2=parseInt(month)-1;if(month2==0){year2=parseInt(year2)-1;month2=12}var day2=day;var days2=new Date(year2,month2,0);days2=days2.getDate();if(day2>days2){day2=days2}if(month2<10){month2='0'+month2}var t2=year2+'-'+month2+'-'+day2;return t2}function getNextMonth(date){var arr=date.split('-');var year=arr[0];var month=arr[1];var day=arr[2];var days=new Date(year,month,0);days=days.getDate();var year2=year;var month2=parseInt(month)+1;if(month2==13){year2=parseInt(year2)+1;month2=1}var day2=day;var days2=new Date(year2,month2,0);days2=days2.getDate();if(day2>days2){day2=days2}if(month2<10){month2='0'+month2}var t2=year2+'-'+month2+'-'+day2;return t2}